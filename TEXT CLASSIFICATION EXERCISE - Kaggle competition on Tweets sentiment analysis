{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "840c2f4a",
   "metadata": {},
   "source": [
    "# TEXT CLASSIFICATION EXERCISE - Kaggle competition on Tweets sentiment analysis\n",
    "Master in Artificial Intelligence<br>\n",
    "Natural Langage Processing Class<br>\n",
    "Frank Barreto<br>\n",
    "20/11/2021<br>"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dfa293b1",
   "metadata": {},
   "source": [
    "### Import libraries and define useful functions"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 514,
   "id": "45d5238c",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Once deleted, variables cannot be recovered. Proceed (y/[n])? y\n",
      "2.7.0\n"
     ]
    }
   ],
   "source": [
    "%reset\n",
    "\n",
    "import tensorflow as tf\n",
    "print(tf.__version__)\n",
    "\n",
    "import nltk\n",
    "\n",
    "import csv\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "import seaborn as sns\n",
    "\n",
    "import tensorflow as tf\n",
    "from tensorflow.keras.preprocessing.text import Tokenizer\n",
    "from tensorflow.keras.preprocessing.sequence import pad_sequences\n",
    "\n",
    "from tensorflow.keras.models import Sequential\n",
    "from tensorflow.keras.layers import Input, Dense, GRU, LSTM, Embedding, Dropout, Bidirectional,\\\n",
    "SpatialDropout1D, Conv1D, MaxPooling1D, Flatten\n",
    "from tensorflow.keras import layers, initializers\n",
    "from tensorflow.keras.optimizers import SGD, Adam\n",
    "from tensorflow.keras import regularizers\n",
    "\n",
    "import re\n",
    "from sklearn.model_selection import train_test_split\n",
    "from sklearn.metrics import accuracy_score\n",
    "from nltk.corpus import stopwords\n",
    "from nltk.tokenize import WordPunctTokenizer\n",
    "#Stemmer.\n",
    "from nltk.stem.snowball import SnowballStemmer\n",
    "#Lemmatization.\n",
    "from nltk import WordNetLemmatizer\n",
    "tok = WordPunctTokenizer()\n",
    "stop_words = set(stopwords.words('english'))\n",
    "\n",
    "%matplotlib inline"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 515,
   "id": "35b3a63d",
   "metadata": {},
   "outputs": [],
   "source": [
    "import matplotlib.pyplot as plt\n",
    "\n",
    "# function to plot train and validation over epochs\n",
    "def plot_graphs(history, string):\n",
    "    plt.plot(history.history[string])\n",
    "    plt.plot(history.history['val_'+string])\n",
    "    plt.xlabel(\"Epochs\")\n",
    "    plt.ylabel(string)\n",
    "    plt.legend([string, 'val_'+string])\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 516,
   "id": "e78cc83c",
   "metadata": {},
   "outputs": [],
   "source": [
    "# function to plot confussion matrix\n",
    "def plot_confussion_matrix(labels, predictions, classes, figsize = 3):\n",
    "    \n",
    "    con_mat = tf.math.confusion_matrix(labels, predictions).numpy()\n",
    "\n",
    "    con_mat_norm = np.around(con_mat.astype('float') / con_mat.sum(axis = 1)[:, np.newaxis], decimals = 3)\n",
    "\n",
    "    con_mat_df = pd.DataFrame(con_mat_norm,\n",
    "                         index = classes, \n",
    "                         columns = classes)\n",
    "\n",
    "    figure = plt.figure(figsize=(figsize, figsize))\n",
    "    sns.heatmap(con_mat_df\n",
    "                , annot=True\n",
    "                , xticklabels=classes\n",
    "                , yticklabels=classes\n",
    "                #, cmap=plt.cm.Blues\n",
    "                )\n",
    "    plt.tight_layout()\n",
    "    plt.ylabel('True label')\n",
    "    plt.xlabel('Predicted label')\n",
    "    plt.xlim(-0.0, len(classes))\n",
    "    plt.ylim(len(classes), -0.0)\n",
    "    plt.show()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "07509920",
   "metadata": {},
   "source": [
    "### Read 10% of Kaggle data\n",
    "downloaded from: https://www.kaggle.com/kazanova/sentiment140"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 517,
   "id": "06389d22",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(159998, 6)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>target</th>\n",
       "      <th>ids</th>\n",
       "      <th>date</th>\n",
       "      <th>flag</th>\n",
       "      <th>user</th>\n",
       "      <th>text</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>1467813985</td>\n",
       "      <td>Mon Apr 06 22:20:37 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>quanvu</td>\n",
       "      <td>@alydesigns i was out most of the day so didn'...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>1467815923</td>\n",
       "      <td>Mon Apr 06 22:21:07 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>fatkat309</td>\n",
       "      <td>some1 hacked my account on aim  now i have to ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>1467818020</td>\n",
       "      <td>Mon Apr 06 22:21:39 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>itsanimesh</td>\n",
       "      <td>really don't feel like getting up today... but...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0</td>\n",
       "      <td>1467820863</td>\n",
       "      <td>Mon Apr 06 22:22:23 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>tautao</td>\n",
       "      <td>Broadband plan 'a massive broken promise' http...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>1467822687</td>\n",
       "      <td>Mon Apr 06 22:22:52 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>xVivaLaJuicyx</td>\n",
       "      <td>@BatManYNG I miss my ps3, it's out of commissi...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>0</td>\n",
       "      <td>1467825411</td>\n",
       "      <td>Mon Apr 06 22:23:35 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>michrod</td>\n",
       "      <td>@jdarter Oh! Haha... dude I dont really look a...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>0</td>\n",
       "      <td>1467834053</td>\n",
       "      <td>Mon Apr 06 22:25:52 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>thelazyboy</td>\n",
       "      <td>sleep soon... i just hate saying bye and see y...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>0</td>\n",
       "      <td>1467835345</td>\n",
       "      <td>Mon Apr 06 22:26:10 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>RU_it_girl</td>\n",
       "      <td>@Hollywoodheat I should have paid more attenti...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>0</td>\n",
       "      <td>1467836873</td>\n",
       "      <td>Mon Apr 06 22:26:33 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>LeakySpoon</td>\n",
       "      <td>Body Of Missing Northern Calif. Girl Found: P...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>0</td>\n",
       "      <td>1467838189</td>\n",
       "      <td>Mon Apr 06 22:26:54 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>missannabanana</td>\n",
       "      <td>laying in bed with no voice..</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>0</td>\n",
       "      <td>1467839737</td>\n",
       "      <td>Mon Apr 06 22:27:21 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>JenBah</td>\n",
       "      <td>Is pissed off that there's no ASBA's for a rad...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>0</td>\n",
       "      <td>1467841897</td>\n",
       "      <td>Mon Apr 06 22:27:56 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>aaronrothe</td>\n",
       "      <td>@chelserlynn haha its so cooooold in the d! an...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>0</td>\n",
       "      <td>1467843075</td>\n",
       "      <td>Mon Apr 06 22:28:15 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>darkninja757</td>\n",
       "      <td>sadly is going to bed.</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>0</td>\n",
       "      <td>1467844157</td>\n",
       "      <td>Mon Apr 06 22:28:32 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>AKyarnie</td>\n",
       "      <td>@onemoreproject that is lame</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>0</td>\n",
       "      <td>1467853356</td>\n",
       "      <td>Mon Apr 06 22:30:54 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>dbmendel</td>\n",
       "      <td>Picked Mich St to win it all from the get go. ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>0</td>\n",
       "      <td>1467856044</td>\n",
       "      <td>Mon Apr 06 22:31:35 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>EcoTravelTV</td>\n",
       "      <td>Crazy wind today = no birding  http://ff.im/1XTTi</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>0</td>\n",
       "      <td>1467857511</td>\n",
       "      <td>Mon Apr 06 22:31:59 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>fatkat309</td>\n",
       "      <td>@dannyvegasbaby danny im upset that i wasnt he...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>0</td>\n",
       "      <td>1467859558</td>\n",
       "      <td>Mon Apr 06 22:32:30 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>tchviolin</td>\n",
       "      <td>I activated my Selfcontrol block early, meanin...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>0</td>\n",
       "      <td>1467861522</td>\n",
       "      <td>Mon Apr 06 22:33:00 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>bovinemammal</td>\n",
       "      <td>Job Interview in Cardiff today, wish me luck! ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>0</td>\n",
       "      <td>1467863507</td>\n",
       "      <td>Mon Apr 06 22:33:32 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>Mirlina</td>\n",
       "      <td>My nap was interrupted so many times today  Go...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    target         ids                          date      flag  \\\n",
       "0        0  1467813985  Mon Apr 06 22:20:37 PDT 2009  NO_QUERY   \n",
       "1        0  1467815923  Mon Apr 06 22:21:07 PDT 2009  NO_QUERY   \n",
       "2        0  1467818020  Mon Apr 06 22:21:39 PDT 2009  NO_QUERY   \n",
       "3        0  1467820863  Mon Apr 06 22:22:23 PDT 2009  NO_QUERY   \n",
       "4        0  1467822687  Mon Apr 06 22:22:52 PDT 2009  NO_QUERY   \n",
       "5        0  1467825411  Mon Apr 06 22:23:35 PDT 2009  NO_QUERY   \n",
       "6        0  1467834053  Mon Apr 06 22:25:52 PDT 2009  NO_QUERY   \n",
       "7        0  1467835345  Mon Apr 06 22:26:10 PDT 2009  NO_QUERY   \n",
       "8        0  1467836873  Mon Apr 06 22:26:33 PDT 2009  NO_QUERY   \n",
       "9        0  1467838189  Mon Apr 06 22:26:54 PDT 2009  NO_QUERY   \n",
       "10       0  1467839737  Mon Apr 06 22:27:21 PDT 2009  NO_QUERY   \n",
       "11       0  1467841897  Mon Apr 06 22:27:56 PDT 2009  NO_QUERY   \n",
       "12       0  1467843075  Mon Apr 06 22:28:15 PDT 2009  NO_QUERY   \n",
       "13       0  1467844157  Mon Apr 06 22:28:32 PDT 2009  NO_QUERY   \n",
       "14       0  1467853356  Mon Apr 06 22:30:54 PDT 2009  NO_QUERY   \n",
       "15       0  1467856044  Mon Apr 06 22:31:35 PDT 2009  NO_QUERY   \n",
       "16       0  1467857511  Mon Apr 06 22:31:59 PDT 2009  NO_QUERY   \n",
       "17       0  1467859558  Mon Apr 06 22:32:30 PDT 2009  NO_QUERY   \n",
       "18       0  1467861522  Mon Apr 06 22:33:00 PDT 2009  NO_QUERY   \n",
       "19       0  1467863507  Mon Apr 06 22:33:32 PDT 2009  NO_QUERY   \n",
       "\n",
       "              user                                               text  \n",
       "0           quanvu  @alydesigns i was out most of the day so didn'...  \n",
       "1        fatkat309  some1 hacked my account on aim  now i have to ...  \n",
       "2       itsanimesh  really don't feel like getting up today... but...  \n",
       "3           tautao  Broadband plan 'a massive broken promise' http...  \n",
       "4    xVivaLaJuicyx  @BatManYNG I miss my ps3, it's out of commissi...  \n",
       "5          michrod  @jdarter Oh! Haha... dude I dont really look a...  \n",
       "6       thelazyboy  sleep soon... i just hate saying bye and see y...  \n",
       "7       RU_it_girl  @Hollywoodheat I should have paid more attenti...  \n",
       "8       LeakySpoon   Body Of Missing Northern Calif. Girl Found: P...  \n",
       "9   missannabanana                     laying in bed with no voice..   \n",
       "10          JenBah  Is pissed off that there's no ASBA's for a rad...  \n",
       "11      aaronrothe  @chelserlynn haha its so cooooold in the d! an...  \n",
       "12    darkninja757                            sadly is going to bed.   \n",
       "13        AKyarnie                      @onemoreproject that is lame   \n",
       "14        dbmendel  Picked Mich St to win it all from the get go. ...  \n",
       "15     EcoTravelTV  Crazy wind today = no birding  http://ff.im/1XTTi  \n",
       "16       fatkat309  @dannyvegasbaby danny im upset that i wasnt he...  \n",
       "17       tchviolin  I activated my Selfcontrol block early, meanin...  \n",
       "18    bovinemammal  Job Interview in Cardiff today, wish me luck! ...  \n",
       "19         Mirlina  My nap was interrupted so many times today  Go...  "
      ]
     },
     "execution_count": 517,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "n=10 # every 10th row = 10% of the rows. This way we get a diverse representation of the dataset.\n",
    "df = pd.read_csv('training.1600000.processed.noemoticon.csv'\n",
    "                 , encoding = 'latin-1'#'utf-8'\n",
    "                 , delimiter = ','\n",
    "                 , index_col = False\n",
    "                 , header = 1\n",
    "                 , usecols = [0, 1, 2, 3, 4, 5]\n",
    "                 , names = ['target', 'ids', 'date', 'flag', 'user', 'text']\n",
    "                 , skiprows=lambda i: i % n != 0\n",
    ")\n",
    "print(df.shape)\n",
    "df.head(20)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 518,
   "id": "f6f117b3",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "4    80000\n",
       "0    79998\n",
       "Name: target, dtype: int64"
      ]
     },
     "execution_count": 518,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Lets see if the dataset is balanced.\n",
    "df['target'].value_counts()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "79f52535",
   "metadata": {},
   "source": [
    "### Experimentation parameters"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 519,
   "id": "843616d9",
   "metadata": {},
   "outputs": [],
   "source": [
    "epochs = 10\n",
    "batch_size = 524\n",
    "vocab_size = 15000\n",
    "embedding_dim = 50 \n",
    "max_length = 40\n",
    "# num_convolution = 5\n",
    "trunc_type = 'pre'\n",
    "padding_type = 'pre'\n",
    "oov_tok = '<OOV>' \n",
    "training_portion = .6\n",
    "test_proportion = 0.2"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3a3975ef",
   "metadata": {},
   "source": [
    "### Converting target variables to a Binary problem of 0 and 1. And change 'text' column to string\n",
    "0 ----> negative comment<br>\n",
    "1 ----> positive comment"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 520,
   "id": "8950cd64",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 159998 entries, 0 to 159997\n",
      "Data columns (total 6 columns):\n",
      " #   Column  Non-Null Count   Dtype \n",
      "---  ------  --------------   ----- \n",
      " 0   target  159998 non-null  object\n",
      " 1   ids     159998 non-null  int64 \n",
      " 2   date    159998 non-null  object\n",
      " 3   flag    159998 non-null  object\n",
      " 4   user    159998 non-null  object\n",
      " 5   text    159998 non-null  object\n",
      "dtypes: int64(1), object(5)\n",
      "memory usage: 7.3+ MB\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "<ipython-input-520-b4700e8d0399>:1: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  df['target'][df['target']==0]='negative'\n"
     ]
    }
   ],
   "source": [
    "df['target'][df['target']==0]='negative'\n",
    "df['target'][df['target']==4]='positive'\n",
    "df['text'] = df['text'].astype(str)\n",
    "df.info()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0b9838cb",
   "metadata": {},
   "source": [
    "### Shuffling and dividing data set in training and test"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 521,
   "id": "b558e5ac",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(127998, 6)\n",
      "(32000, 6)\n"
     ]
    }
   ],
   "source": [
    "df, df_test = np.split(df.sample(frac=1).reset_index(drop=True), [int((1-test_proportion)*len(df))])\n",
    "\n",
    "print(df.shape)\n",
    "print(df_test.shape)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e6c27ca3",
   "metadata": {},
   "source": [
    "### Cleaning Text, Lemmatizer, Stemmizer."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 522,
   "id": "a993ce7d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>target</th>\n",
       "      <th>ids</th>\n",
       "      <th>date</th>\n",
       "      <th>flag</th>\n",
       "      <th>user</th>\n",
       "      <th>text</th>\n",
       "      <th>text_clean</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>positive</td>\n",
       "      <td>2175025808</td>\n",
       "      <td>Sun Jun 14 23:54:08 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>Sherrybeary</td>\n",
       "      <td>http://twitpic.com/7g868 - Had a nice hike hal...</td>\n",
       "      <td>nice hike half way mount wilson like cloudy su...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>negative</td>\n",
       "      <td>2215846295</td>\n",
       "      <td>Wed Jun 17 18:41:34 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>amnesiac91</td>\n",
       "      <td>is bummed that you can't send pics or tether w...</td>\n",
       "      <td>bummed send pics tether new iphone software</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>negative</td>\n",
       "      <td>1989419689</td>\n",
       "      <td>Mon Jun 01 01:28:20 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>simondugard</td>\n",
       "      <td>@jackconnor89 yeah its mad my best friends is ...</td>\n",
       "      <td>yeah mad best friends supporter</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>negative</td>\n",
       "      <td>2007800500</td>\n",
       "      <td>Tue Jun 02 13:10:15 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>nazubritsky</td>\n",
       "      <td>@Karadiak Where'd you go, Marshall's? I went t...</td>\n",
       "      <td>go marshall went loehmann today low bathing suits</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>negative</td>\n",
       "      <td>1823216205</td>\n",
       "      <td>Sat May 16 21:23:45 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>dez_a_rey</td>\n",
       "      <td>My knee is really hurting... This can't be good</td>\n",
       "      <td>knee really hurting good</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>positive</td>\n",
       "      <td>1984467099</td>\n",
       "      <td>Sun May 31 15:09:51 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>tampasmile</td>\n",
       "      <td>@TwoSteppinAnt Right back at'cha! Another frie...</td>\n",
       "      <td>right back cha another friend sent self contro...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>negative</td>\n",
       "      <td>2000572445</td>\n",
       "      <td>Mon Jun 01 22:25:23 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>Cassie198706</td>\n",
       "      <td>i need to get the battery replaced for my car ...</td>\n",
       "      <td>need get battery replaced car zapper use car k...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>negative</td>\n",
       "      <td>2015154658</td>\n",
       "      <td>Wed Jun 03 03:52:04 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>marathoncrew</td>\n",
       "      <td>MCM Origin Live Score Update= NSW 6 vs QLD 18 ...</td>\n",
       "      <td>mcm origin live score update nsw vs qld origin...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>negative</td>\n",
       "      <td>1978470152</td>\n",
       "      <td>Sat May 30 23:27:25 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>SmileyKy</td>\n",
       "      <td>Has a sore throat!</td>\n",
       "      <td>sore throat</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>positive</td>\n",
       "      <td>2000333487</td>\n",
       "      <td>Mon Jun 01 21:53:35 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>blm03</td>\n",
       "      <td>@heartmychloe I've got it set up to tape already</td>\n",
       "      <td>got set tape already</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>positive</td>\n",
       "      <td>1968899814</td>\n",
       "      <td>Fri May 29 22:29:52 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>sierrabardot</td>\n",
       "      <td>@mileycyrus you can have a little  back. it's ...</td>\n",
       "      <td>little back gave amazing person miley never fo...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>negative</td>\n",
       "      <td>2230514212</td>\n",
       "      <td>Thu Jun 18 17:13:15 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>stellery</td>\n",
       "      <td>@Kikirowr Aww  What's wrong?</td>\n",
       "      <td>aww wrong</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>positive</td>\n",
       "      <td>1823918071</td>\n",
       "      <td>Sat May 16 23:24:51 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>Somaya_Reece</td>\n",
       "      <td>On a side note: I have many POSITIVE PPL helpi...</td>\n",
       "      <td>side note many positive ppl helping spread wor...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>positive</td>\n",
       "      <td>1564299162</td>\n",
       "      <td>Mon Apr 20 02:48:10 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>shadowphlip</td>\n",
       "      <td>trying to figure out what ive got to write her...</td>\n",
       "      <td>trying figure ive got write get random strange...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>negative</td>\n",
       "      <td>2301292451</td>\n",
       "      <td>Tue Jun 23 15:14:59 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>Vegas_Princess</td>\n",
       "      <td>@lovelylynda 10 hour drive.</td>\n",
       "      <td>hour drive</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>positive</td>\n",
       "      <td>1970717323</td>\n",
       "      <td>Sat May 30 04:57:48 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>pawith</td>\n",
       "      <td>Rain last night. Cleaned scary room 90% better...</td>\n",
       "      <td>rain last night cleaned scary room better vaca...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>positive</td>\n",
       "      <td>1991051472</td>\n",
       "      <td>Mon Jun 01 06:18:20 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>SarahHoste</td>\n",
       "      <td>http://bit.ly/ElQvi  Just saw this vid and lov...</td>\n",
       "      <td>saw vid loved somehow</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>positive</td>\n",
       "      <td>1990969788</td>\n",
       "      <td>Mon Jun 01 06:08:18 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>Illy02</td>\n",
       "      <td>@bowwow614 any publicity is gud publicity u ai...</td>\n",
       "      <td>publicity gud publicity aint got worry kno</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>negative</td>\n",
       "      <td>2288184929</td>\n",
       "      <td>Mon Jun 22 18:49:54 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>WintanaBee</td>\n",
       "      <td>No Jon and Kate!!!! Not a divorce.....this is ...</td>\n",
       "      <td>jon kate divorce tragic</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>negative</td>\n",
       "      <td>2031688959</td>\n",
       "      <td>Thu Jun 04 10:10:37 PDT 2009</td>\n",
       "      <td>NO_QUERY</td>\n",
       "      <td>MarcelaVisco</td>\n",
       "      <td>@avenuebmusic Why isn't it on MySpace? Can't e...</td>\n",
       "      <td>myspace even find itunes brazil</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      target         ids                          date      flag  \\\n",
       "0   positive  2175025808  Sun Jun 14 23:54:08 PDT 2009  NO_QUERY   \n",
       "1   negative  2215846295  Wed Jun 17 18:41:34 PDT 2009  NO_QUERY   \n",
       "2   negative  1989419689  Mon Jun 01 01:28:20 PDT 2009  NO_QUERY   \n",
       "3   negative  2007800500  Tue Jun 02 13:10:15 PDT 2009  NO_QUERY   \n",
       "4   negative  1823216205  Sat May 16 21:23:45 PDT 2009  NO_QUERY   \n",
       "5   positive  1984467099  Sun May 31 15:09:51 PDT 2009  NO_QUERY   \n",
       "6   negative  2000572445  Mon Jun 01 22:25:23 PDT 2009  NO_QUERY   \n",
       "7   negative  2015154658  Wed Jun 03 03:52:04 PDT 2009  NO_QUERY   \n",
       "8   negative  1978470152  Sat May 30 23:27:25 PDT 2009  NO_QUERY   \n",
       "9   positive  2000333487  Mon Jun 01 21:53:35 PDT 2009  NO_QUERY   \n",
       "10  positive  1968899814  Fri May 29 22:29:52 PDT 2009  NO_QUERY   \n",
       "11  negative  2230514212  Thu Jun 18 17:13:15 PDT 2009  NO_QUERY   \n",
       "12  positive  1823918071  Sat May 16 23:24:51 PDT 2009  NO_QUERY   \n",
       "13  positive  1564299162  Mon Apr 20 02:48:10 PDT 2009  NO_QUERY   \n",
       "14  negative  2301292451  Tue Jun 23 15:14:59 PDT 2009  NO_QUERY   \n",
       "15  positive  1970717323  Sat May 30 04:57:48 PDT 2009  NO_QUERY   \n",
       "16  positive  1991051472  Mon Jun 01 06:18:20 PDT 2009  NO_QUERY   \n",
       "17  positive  1990969788  Mon Jun 01 06:08:18 PDT 2009  NO_QUERY   \n",
       "18  negative  2288184929  Mon Jun 22 18:49:54 PDT 2009  NO_QUERY   \n",
       "19  negative  2031688959  Thu Jun 04 10:10:37 PDT 2009  NO_QUERY   \n",
       "\n",
       "              user                                               text  \\\n",
       "0      Sherrybeary  http://twitpic.com/7g868 - Had a nice hike hal...   \n",
       "1       amnesiac91  is bummed that you can't send pics or tether w...   \n",
       "2      simondugard  @jackconnor89 yeah its mad my best friends is ...   \n",
       "3      nazubritsky  @Karadiak Where'd you go, Marshall's? I went t...   \n",
       "4        dez_a_rey   My knee is really hurting... This can't be good    \n",
       "5       tampasmile  @TwoSteppinAnt Right back at'cha! Another frie...   \n",
       "6     Cassie198706  i need to get the battery replaced for my car ...   \n",
       "7     marathoncrew  MCM Origin Live Score Update= NSW 6 vs QLD 18 ...   \n",
       "8         SmileyKy                                Has a sore throat!    \n",
       "9            blm03  @heartmychloe I've got it set up to tape already    \n",
       "10    sierrabardot  @mileycyrus you can have a little  back. it's ...   \n",
       "11        stellery                       @Kikirowr Aww  What's wrong?   \n",
       "12    Somaya_Reece  On a side note: I have many POSITIVE PPL helpi...   \n",
       "13     shadowphlip  trying to figure out what ive got to write her...   \n",
       "14  Vegas_Princess                      @lovelylynda 10 hour drive.     \n",
       "15          pawith  Rain last night. Cleaned scary room 90% better...   \n",
       "16      SarahHoste  http://bit.ly/ElQvi  Just saw this vid and lov...   \n",
       "17          Illy02  @bowwow614 any publicity is gud publicity u ai...   \n",
       "18      WintanaBee  No Jon and Kate!!!! Not a divorce.....this is ...   \n",
       "19    MarcelaVisco  @avenuebmusic Why isn't it on MySpace? Can't e...   \n",
       "\n",
       "                                           text_clean  \n",
       "0   nice hike half way mount wilson like cloudy su...  \n",
       "1         bummed send pics tether new iphone software  \n",
       "2                     yeah mad best friends supporter  \n",
       "3   go marshall went loehmann today low bathing suits  \n",
       "4                            knee really hurting good  \n",
       "5   right back cha another friend sent self contro...  \n",
       "6   need get battery replaced car zapper use car k...  \n",
       "7   mcm origin live score update nsw vs qld origin...  \n",
       "8                                         sore throat  \n",
       "9                                got set tape already  \n",
       "10  little back gave amazing person miley never fo...  \n",
       "11                                          aww wrong  \n",
       "12  side note many positive ppl helping spread wor...  \n",
       "13  trying figure ive got write get random strange...  \n",
       "14                                         hour drive  \n",
       "15  rain last night cleaned scary room better vaca...  \n",
       "16                              saw vid loved somehow  \n",
       "17         publicity gud publicity aint got worry kno  \n",
       "18                            jon kate divorce tragic  \n",
       "19                    myspace even find itunes brazil  "
      ]
     },
     "execution_count": 522,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pat1 = r'http[^ ]+' # pattern to remove links\n",
    "pat2 = r'www.[^ ]+' # pattern to remove links\n",
    "pat3 = '[^a-zA-Z]+' # pattern to remove numbers\n",
    "pat4 = r\"@[^ ]+\"     #pattern to remove usernames\n",
    "pat = r'|'.join((pat1, pat2, pat3))\n",
    "\n",
    "def get_clean_text(text):\n",
    "    text = text.lower() # lowercase\n",
    "    text = re.sub(pat4, ' ', text)  #remove username\n",
    "    text = re.sub(pat, ' ', text) # remove pat\n",
    "    text = [w for w in tok.tokenize(text) if not w in stop_words] # remove stop_words\n",
    "    text = [w for w in text if len(w)>1] # remove words with len <2\n",
    "    \n",
    "    #Stemmer.\n",
    "    #stemmer = SnowballStemmer(\"english\")\n",
    "    #text=[stemmer.stem(w) for w in text]\n",
    "    \n",
    "    #Lemmatizer.\n",
    "    #lemmatizer=WordNetLemmatizer()\n",
    "    #text=[lemmatizer.lemmatize(w) for w in text]\n",
    "   \n",
    "    text = (' '.join(text)).strip() # list to string\n",
    "    return text\n",
    "\n",
    "df['text_clean'] = [get_clean_text(t) for t in df['text']]\n",
    "\n",
    "df.head(20)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "107b807a",
   "metadata": {},
   "source": [
    "### Train and validation split"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 523,
   "id": "0977941a",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Distinct categories in train set :2\n",
      "x_train records :76798\n",
      "y_train records :76798\n",
      "x_val records :51200\n",
      "y_val records :51200\n"
     ]
    }
   ],
   "source": [
    "y = df['target']\n",
    "x = df['text_clean']\n",
    "\n",
    "label_distinct = len(set(y)) # this might be use as a dynamic parameter for the cost function layer (number of output neurons)\n",
    "print('Distinct categories in train set :' + str(label_distinct))\n",
    "\n",
    "train_size = int(len(y) * training_portion)\n",
    "\n",
    "x_train = x[0: train_size]\n",
    "y_train = y[0: train_size]\n",
    "x_val = x[train_size:]\n",
    "y_val = y[train_size:]\n",
    "\n",
    "print('x_train records :' + str(len(x_train)))\n",
    "print('y_train records :' + str(len(y_train)))\n",
    "print('x_val records :' + str(len(x_val)))\n",
    "print('y_val records :' + str(len(y_val)))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "00d2e7d2",
   "metadata": {},
   "source": [
    "### Tokenize text"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 524,
   "id": "be046661",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "label_index{'negative': 0, 'positive': 1}\n",
      "Dictionary examples: {'<OOV>': 1, 'good': 2, 'day': 3, 'get': 4, 'like': 5, 'quot': 6, 'go': 7, 'today': 8, 'going': 9, 'love': 10}\n"
     ]
    }
   ],
   "source": [
    "label_tokenizer = Tokenizer() # Tokenizer is a functionality from tensorflow wich transforms words into numbers. Once a word\n",
    "# has been converted to a number, every consecutive upcoming word already seen is converted to the same number\n",
    "# This process is called tokenization\n",
    "label_tokenizer.fit_on_texts(y_train) # fit will return a dictionary\n",
    "label_index = label_tokenizer.word_index # save indexes for reverse transformation\n",
    "\n",
    "for k in label_index:\n",
    "    label_index[k] -= 1\n",
    "print('label_index' + str(label_index))\n",
    "\n",
    "\n",
    "label_tokenizer = Tokenizer()\n",
    "\n",
    "tokenizer = Tokenizer(num_words = vocab_size   # max words to be considered\n",
    "                      , oov_token=oov_tok)     #I want \"OOV\" in bracket to be used to for words that are not in the word index.\n",
    "tokenizer.fit_on_texts(x_train)                # fit will return a dictionary\n",
    "word_index = tokenizer.word_index              # save indexes for reverse transformation\n",
    "\n",
    "print('Dictionary examples: ' + str(dict(list(word_index.items())[0:10])))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 525,
   "id": "0c24f4de",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Transform data with fitted tokenizer.\n",
    "x_train_seq = tokenizer.texts_to_sequences(x_train)\n",
    "x_val_seq = tokenizer.texts_to_sequences(x_val)\n",
    "\n",
    "y_train_seq = np.array(y_train.map(label_index))\n",
    "y_val_seq = np.array(y_val.map(label_index))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e1acba69",
   "metadata": {},
   "source": [
    "### Padding"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 526,
   "id": "a3c2c575",
   "metadata": {},
   "outputs": [],
   "source": [
    "x_train_pad = pad_sequences(x_train_seq, maxlen=max_length, padding=padding_type, truncating=trunc_type)\n",
    "x_val_pad = pad_sequences(x_val_seq, maxlen=max_length, padding=padding_type, truncating=trunc_type)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "ae79185b",
   "metadata": {},
   "source": [
    "###  Sequence Decoder"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 527,
   "id": "7f29a85a",
   "metadata": {},
   "outputs": [],
   "source": [
    "reverse_word_index = dict([(value, key) for (key, value) in word_index.items()])\n",
    "\n",
    "def decode_text(text):\n",
    "    print(text)\n",
    "    return ' '.join([reverse_word_index.get(i, '?') for i in text])"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "6fab8f8c",
   "metadata": {},
   "source": [
    "### Embedding"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 528,
   "id": "842f21bf",
   "metadata": {},
   "outputs": [],
   "source": [
    "embeddings_index = {}\n",
    "\n",
    "f = open(\"glove.6B.50d.txt\", encoding=\"utf8\")\n",
    "for line in f:\n",
    "    values = line.split() # the actual vector representation\n",
    "    word = values[0] # the original word\n",
    "    # place vector representation in the value where \"key\" equals \"word\"\n",
    "    embeddings_index[word] = np.asarray(values[1:], dtype='float32')\n",
    "f.close()\n",
    "\n",
    "embedding_matrix = np.random.random((len(word_index) + 1, embedding_dim))\n",
    "for word, i in word_index.items(): # for each word in word_index dictionary\n",
    "    embedding_vector = embeddings_index.get(word)# capture vector reprsntation using \"word\" as key\n",
    "    if embedding_vector is not None:\n",
    "        embedding_matrix[i] = embedding_vector"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "fed3b19c",
   "metadata": {},
   "source": [
    "### Model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 529,
   "id": "3d94d620",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "43821"
      ]
     },
     "execution_count": 529,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len_word_index = len(word_index)\n",
    "len_word_index"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 530,
   "id": "013d9ac7",
   "metadata": {},
   "outputs": [],
   "source": [
    "def make_model(  bidirectional_layers = 1\n",
    "               , bidirectional_dropout = 0.0\n",
    "               , dense_layers = 1\n",
    "               , dense_dropout = 0.0\n",
    "               , lr = 1e-3\n",
    "               , output_bias = None\n",
    "               , verbose = 1):\n",
    "    \n",
    "    model = Sequential()\n",
    "    \n",
    "    model.add(Embedding(input_dim = len_word_index + 1 # the entering token j (j its a number) \n",
    "        #finds itÂ´s word representation in the j row, where rows are \"len_word_index + 1\".\n",
    "                       , output_dim = embedding_dim # word representation dimension. Question\n",
    "                       , weights = [embedding_matrix] # pretrained embedding\n",
    "                       , input_length = max_length # Expected text size\n",
    "                       , trainable = False)) # Trainable = True when embedding elegigble to change\n",
    "    \n",
    "    for i in range(0,bidirectional_layers):\n",
    "        \n",
    "        # return_sequences -> last bidirectional doesnt return requences\n",
    "        return_sequences = ((bidirectional_layers - i) != 1)\n",
    "        model.add(Bidirectional(LSTM(embedding_dim\n",
    "                                 , activation = 'relu'\n",
    "                                 , dropout = bidirectional_dropout # regularization \n",
    "                                 , recurrent_dropout = bidirectional_dropout # regularization\n",
    "                                 , return_sequences = return_sequences))\n",
    "                  )\n",
    "\n",
    "    for i in range(0,dense_layers):\n",
    "        model.add(Dense(embedding_dim, activation='relu')) # dense layers\n",
    "        if dense_dropout != 0.0:\n",
    "            model.add(Dropout(dense_dropout)) # regularization\n",
    "            \n",
    "    # bias the cost function\n",
    "    if output_bias is not None:\n",
    "        output_bias = initializers.Constant(output_bias)\n",
    "    else:\n",
    "        output_bias = 'zeros'    \n",
    "    \n",
    "    model.add(Dense(label_distinct\n",
    "                    , activation='softmax'\n",
    "                    , bias_initializer = output_bias))    \n",
    "\n",
    "    model.compile(loss = 'sparse_categorical_crossentropy' # return prob dist\n",
    "                  , optimizer = Adam(lr) # classic classification optimizer\n",
    "                  , metrics = ['accuracy'])\n",
    "    if verbose:\n",
    "        \n",
    "        print('bidirectional_layers :' + str(bidirectional_layers))\n",
    "        print('bidirectional_dropout :' + str(bidirectional_dropout))\n",
    "        print('dense_layers :' + str(dense_layers))\n",
    "        print('dense_dropout :' + str(dense_dropout))\n",
    "        print('lr :' + str(lr))\n",
    "\n",
    "        print(model.summary())\n",
    "    \n",
    "    return model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 531,
   "id": "bb72a49a",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "bidirectional_layers :1\n",
      "bidirectional_dropout :0.0\n",
      "dense_layers :1\n",
      "dense_dropout :0.0\n",
      "lr :0.001\n",
      "Model: \"sequential_11\"\n",
      "_________________________________________________________________\n",
      " Layer (type)                Output Shape              Param #   \n",
      "=================================================================\n",
      " embedding_10 (Embedding)    (None, 40, 50)            2191100   \n",
      "                                                                 \n",
      " bidirectional_10 (Bidirecti  (None, 100)              40400     \n",
      " onal)                                                           \n",
      "                                                                 \n",
      " dense_20 (Dense)            (None, 50)                5050      \n",
      "                                                                 \n",
      " dense_21 (Dense)            (None, 2)                 102       \n",
      "                                                                 \n",
      "=================================================================\n",
      "Total params: 2,236,652\n",
      "Trainable params: 45,552\n",
      "Non-trainable params: 2,191,100\n",
      "_________________________________________________________________\n",
      "None\n",
      "Epoch 1/10\n",
      "147/147 [==============================] - 48s 311ms/step - loss: 0.6287 - accuracy: 0.6352 - val_loss: 0.5935 - val_accuracy: 0.6805\n",
      "Epoch 2/10\n",
      "147/147 [==============================] - 45s 304ms/step - loss: 0.5791 - accuracy: 0.6916 - val_loss: 0.5678 - val_accuracy: 0.7025\n",
      "Epoch 3/10\n",
      "147/147 [==============================] - 45s 303ms/step - loss: 0.5546 - accuracy: 0.7125 - val_loss: 0.5478 - val_accuracy: 0.7200\n",
      "Epoch 4/10\n",
      "147/147 [==============================] - 45s 304ms/step - loss: 0.5362 - accuracy: 0.7262 - val_loss: 0.5395 - val_accuracy: 0.7264\n",
      "Epoch 5/10\n",
      "147/147 [==============================] - 44s 301ms/step - loss: 0.5226 - accuracy: 0.7360 - val_loss: 0.5340 - val_accuracy: 0.7304\n",
      "Epoch 6/10\n",
      "147/147 [==============================] - 1593s 11s/step - loss: 0.5136 - accuracy: 0.7426 - val_loss: 0.5335 - val_accuracy: 0.7310\n",
      "Epoch 7/10\n",
      "147/147 [==============================] - 48s 324ms/step - loss: 0.5041 - accuracy: 0.7501 - val_loss: 0.5268 - val_accuracy: 0.7372\n",
      "Epoch 8/10\n",
      "147/147 [==============================] - 44s 302ms/step - loss: 0.4973 - accuracy: 0.7555 - val_loss: 0.5319 - val_accuracy: 0.7321\n",
      "Epoch 9/10\n",
      "147/147 [==============================] - 50s 342ms/step - loss: 0.5049 - accuracy: 0.7553 - val_loss: 0.5313 - val_accuracy: 0.7315\n",
      "Epoch 10/10\n",
      "147/147 [==============================] - 51s 350ms/step - loss: 0.4922 - accuracy: 0.7596 - val_loss: 0.5282 - val_accuracy: 0.7380\n"
     ]
    }
   ],
   "source": [
    "model = make_model()\n",
    "\n",
    "history = model.fit(x_train_pad, y_train_seq\n",
    "                    , epochs=epochs\n",
    "                    , batch_size = batch_size\n",
    "                    , validation_data=(x_val_pad, y_val_seq)\n",
    "                    , verbose=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 532,
   "id": "8e41ab90",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "dict_keys(['loss', 'accuracy', 'val_loss', 'val_accuracy'])\n",
      "Train accuracy :0.7596031427383423\n",
      "Val accuracy :0.7380273342132568\n"
     ]
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x432 with 2 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "# predict over validation to assess model\n",
    "y_pred = np.argmax(model.predict(x_val_pad), axis=-1)\n",
    "\n",
    "history_dict = history.history\n",
    "print(history_dict.keys())\n",
    "\n",
    "acc = history_dict['accuracy']\n",
    "val_acc = history_dict['val_accuracy']\n",
    "loss = history_dict['loss']\n",
    "val_loss = history_dict['val_loss']\n",
    "\n",
    "print('Train accuracy :' + str(acc[-1]))\n",
    "print('Val accuracy :' + str(val_acc[-1]))\n",
    "\n",
    "plot_confussion_matrix(labels = y_val_seq, predictions = y_pred, classes = label_index.keys(), figsize = 6)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "1582d5be",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "e1c7ddad",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
